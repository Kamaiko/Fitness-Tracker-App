name: CD - Preview Build

# ============================================================================
# TODO(Phase 2+): Configure EAS Preview Builds
# ============================================================================
# This workflow is currently DISABLED (workflow_dispatch only).
# It will be configured in Phase 2+ when features are stable enough for QA.
#
# Purpose:
#   - Build EAS Development/Preview builds for QA testing
#   - Triggered on PRs with label "needs-qa" or manual dispatch
#   - Posts QR code in PR comments for easy device installation
#
# Why not enabled now (Phase 0.5):
#   - Infrastructure is still changing frequently
#   - Would waste EAS build limits (30 builds/month on free tier)
#   - Manual builds (eas build) are sufficient for now
#
# When to enable:
#   - Phase 2+: When features are stable and QA testing becomes regular
#   - Suggested frequency: 2-3 builds/week max (not every commit)
# ============================================================================

on:
  # Manual trigger only - no automatic builds yet
  workflow_dispatch:
    inputs:
      platform:
        description: 'Platform to build'
        required: true
        default: 'android'
        type: choice
        options:
          - android
          - ios
          - all

  # TODO(Phase 2+): Uncomment to enable automatic preview builds
  # pull_request:
  #   types: [labeled]
  # Only build when PR has "needs-qa" label

# TODO(Phase 2+): Add concurrency control
# concurrency:
#   group: ${{ github.workflow }}-${{ github.ref }}
#   cancel-in-progress: true

permissions:
  contents: read
  pull-requests: write # For posting QR code comments

jobs:
  preview-build:
    name: EAS Preview Build (${{ github.event.inputs.platform || 'android' }})
    runs-on: ubuntu-latest
    timeout-minutes: 45

    # TODO(Phase 2+): Uncomment to restrict to labeled PRs
    # if: github.event.label.name == 'needs-qa'

    steps:
      - name: TODO Phase 2+
        run: |
          echo "‚ö†Ô∏è  This workflow is not yet configured"
          echo "üìã Configuration steps required:"
          echo "   1. Add EXPO_TOKEN secret to GitHub repo"
          echo "   2. Configure EAS credentials for preview builds"
          echo "   3. Install expo-github-action for EAS build automation"
          echo "   4. Add step to post QR code comment on PR"
          echo ""
          echo "üìö Documentation: docs/CONTRIBUTING.md (CI/CD Architecture section)"
          exit 1

      # TODO(Phase 2+): Implement EAS build steps
      # - name: Checkout code
      #   uses: actions/checkout@v5
      #
      # - name: Setup Node.js
      #   uses: actions/setup-node@v6
      #   with:
      #     node-version: '22'
      #     cache: 'npm'
      #
      # - name: Setup Expo
      #   uses: expo/expo-github-action@v8
      #   with:
      #     expo-version: latest
      #     eas-version: latest
      #     token: ${{ secrets.EXPO_TOKEN }}
      #
      # - name: Install dependencies
      #   run: npm ci
      #
      # - name: EAS Build (Preview)
      #   run: eas build --profile preview --platform ${{ github.event.inputs.platform }} --non-interactive
      #
      # - name: Comment PR with QR code
      #   uses: actions/github-script@v7
      #   with:
      #     script: |
      #       // Get build URL and QR code from EAS
      #       // Post comment on PR with download instructions
